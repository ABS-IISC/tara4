# ALB Security Configuration
# Configures HTTP to HTTPS redirect for security compliance
# Addresses: Shepherd security ticket 7ea46b0e-169e-4171-87df-4ffc45d878a8
# Rule: CloudSecDetections:ALBHttpToHttpsRedirectEnabled

option_settings:
  # Enable HTTP listener on port 80 (for redirect only)
  aws:elbv2:listener:80:
    ListenerEnabled: 'true'
    Protocol: HTTP
    Rules: redirect-to-https

  # Enable HTTPS listener on port 443
  # Note: CloudFront handles SSL/TLS termination, so ALB uses HTTP protocol
  # This is a standard CloudFront -> ALB architecture
  aws:elbv2:listener:443:
    ListenerEnabled: 'true'
    Protocol: HTTP

  # Configure redirect rule from HTTP to HTTPS
  aws:elbv2:listenerrule:redirect-to-https:
    PathPatterns: '*'
    Priority: 1
    Rules: |
      [
        {
          "Type": "redirect",
          "RedirectConfig": {
            "Protocol": "HTTPS",
            "Port": "443",
            "StatusCode": "HTTP_301"
          }
        }
      ]
