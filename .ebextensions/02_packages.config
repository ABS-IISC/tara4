# Package Installation Configuration

packages:
  yum:
    gcc: []
    python3-devel: []
    libxml2-devel: []
    libxslt-devel: []
    git: []

commands:
  01_create_directories:
    command: |
      mkdir -p /var/app/current/uploads
      mkdir -p /var/app/current/data
      mkdir -p /var/log/gunicorn
      chmod 777 /var/app/current/uploads
      chmod 777 /var/app/current/data
      chmod 777 /var/log/gunicorn
    ignoreErrors: true

  02_cleanup_old_uploads:
    command: |
      cat > /etc/cron.daily/cleanup-uploads << 'CLEANUP_SCRIPT'
      #!/bin/bash
      # Clean up files older than 7 days
      find /var/app/current/uploads -type f -mtime +7 -delete
      find /var/app/current/data -type f -mtime +7 -delete
      CLEANUP_SCRIPT
      chmod +x /etc/cron.daily/cleanup-uploads
    ignoreErrors: true

files:
  "/opt/elasticbeanstalk/tasks/taillogs.d/gunicorn.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      /var/log/gunicorn/access.log
      /var/log/gunicorn/error.log

  "/opt/elasticbeanstalk/tasks/bundlelogs.d/gunicorn.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      /var/log/gunicorn/access.log
      /var/log/gunicorn/error.log
